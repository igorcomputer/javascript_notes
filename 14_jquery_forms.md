## jQuery основы работы с Формами 

На текущий момент рассматриваем только отправку форм с помощью AJAX, т.е. без перезагрузки страницы


__Общий алгоритм отправки форм:__

- Заблокировать стандартрую перезагрузку формы при клике на кнопку

- Произвести валидацию полей формы

- В случае успешной валидации, подготовить объект с полями для отправки на сервер

- Отправить данные на сервер (методы GET или POST или другие) 

- Получить ответ от сервера 

- Обработать успешный ответ (вывести сообщение об успешной отправке и/или произвести дополнительные действия)

- Обработать ошибки (oшибки валидации, ошибки на сервере, ошибки интернет соединения, прочие ошибки) 

__Отправка форм: событие submit()__ 

Рассмотрим использования обработчика события __submit__ для форм, использующих перезагрузку страницы (не AJAX формы) 

```
//////////////////////////////////////////////////////////// 
// КОД ОТПРАВКИ ФОРМ 
////////////////////////////////////////////////////////////

$(document).on("submit", ".site_form", sendFormData);   
// или 
$(".site_form").submit(sendFormData);  

// Блокировка многожественных AJAX запросов 
var CanSendAjax = true;

$.ajaxSetup({
  beforeSend: function(){
	CanSendAjax = false; 
  },
  complete: function(){
	CanSendAjax = true; 
  }
});

// Функция отправки формы 
function sendFormData(event){
  event.preventDefault(); // Блокируем стандартное действие формы (перезагрузка) 
  
  if(CanSendAjax == false) {return false;} 
  
  var $form    = $(this); //  Текущая форма  
  var isValid  = validateForm($form); 
  var dataForm = {}; // Данные полей для отправки  

  // Проверка валидации 		
  if(isValid) {
  	
  	dataForm = $form.serialize(); // Универсальный метод - сериализует данные для оправки формы 
  	
  	// Отправляем форму 
  	$.ajax({
  	
		url: '/ajax/form_handler.php',  // Куда оправляем данные на сервере 
		type: 'post', // Метод отправки 
		data: dataForm,   // Отправляемые на сервер данные
		dataType: "json", // Тип данных, получаемых с сервера 
		beforeSend: startLoadingForm($form), // Метод показывающий начало отправки (включает Loader) 
		
	}).done(hadnlerFromServer).fail(handlerErrors);  
	
	// Обработка данных возвращенных с сервера 
	function hadnlerFromServer(response) {
	
		// Если с сервера пришел ответ и он пустой или содержит код ошибки 
		if(response==null || response["status"]=="SendError") {
	  		statusFormError($form);
		}
		
		// Если с сервера пришел ответ об успешной отправке 
		if(response["status"]=="SendOk") { 
			statusFormSuccess($form); 
		};
		
	});
	
    // Возникла ошибка при отправке (404 или 502-я ошибка, нет интернет соединения или ответа от сервера) 
	function handlerErrors( jqXHR, textStatus ) {
		statusFormError($form)
	});
  	
  } else {
  	// Действие при ошибке валидации (можем уведомить пользователя) 
  }
  	
}

function startLoadingForm($form){
	// Запускаем загрузчик формы 
}

function StopLoadingForm($form){
	// Останавливаем загрузчик формы 
}

function statusFormError($form){
	StopLoadingForm($form); 
	// Выводим уведомление об ошибке отправки 
}

function statusFormSuccess($form){
	StopLoadingForm($form); 
	// Выводим сообщение об успешной отправке формы
	// Очищаем все поля формы с целью блокировки повторной отправки данных 
}

function validateForm($form){
	let noerrors       = true;
	let validateFields = "[data-type='required']"; // Селектор для требуемых валидации полей 
	$(validateFields, $form).each(function(){
		if ($.trim($(this).val()) == '') {				
			$(this).addClass("error"); // Сообщение об ошибке для текущего поля  
			noerrors = false;
		} else {
			$(this).removeClass("error"); // Отключение ошибки 
		}
	});
	return noerrors;
}

```

__Примечание:__

Также, вероятно, может потребоваться обработка дополнительных ошибок или нежелательных действий со стороны пользователей: 

- Спам (спам фильтр, например заблокировать определенные номера телефонов, установка капчи, блокировки по IP, блокировки по содержимому отправки). 

- Повторная многократная отправка (когда пользователь многократно нажимает на кнопке во время отправки или пытается после отправки произвести отправку повторно). 

- Возможность отправлять данные только один раз за определенный интервал времени (например, одна отправка любой формы в минуту)


